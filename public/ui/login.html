<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>登录 - STRM Server</title>
    <style>
      body { font-family: system-ui, 'Segoe UI', Roboto, 'Microsoft Yahei', sans-serif; background:#f6f8fb; display:flex;align-items:center;justify-content:center;height:100vh;margin:0 }
      .panel{background:#fff;padding:24px;border-radius:10px;box-shadow:0 8px 24px rgba(22,27,35,0.08);width:380px}
      h2{margin:0 0 12px}
      input{width:100%;padding:10px;border:1px solid #e6e6e6;border-radius:6px;margin-bottom:8px}
      .muted{color:#666;font-size:0.95rem;margin-bottom:12px}
      .btn{display:inline-block;padding:8px 12px;border-radius:6px;border:1px solid #dcdcdc;background:#0b76ef;color:#fff;cursor:pointer}
      .error{color:#b00;margin-top:8px}
    </style>
  </head>
  <body>
    <div class="panel">
      <h2>STRM Server 登录</h2>
      <div class="muted">请输入管理员账号以访问控制台</div>
      <input id="username" placeholder="用户名" />
      <input id="password" placeholder="密码" type="password" />
      <div style="display:flex;gap:8px;align-items:center">
        <button id="loginBtn" class="btn">登录</button>
        <button id="backBtn" style="background:#fff;color:#0b76ef;border:1px solid #0b76ef;padding:8px 12px;border-radius:6px;cursor:pointer">返回</button>
      </div>
      <div id="msg" class="error" aria-live="polite"></div>
    </div>

    <script>
      document.getElementById('loginBtn').addEventListener('click', async () => {
        const u = document.getElementById('username').value || '';
        const p = document.getElementById('password').value || '';
        const msg = document.getElementById('msg');
        msg.textContent = '';
        try {
          const res = await fetch('/auth/login', {
            method: 'POST', headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username: u, password: p })
          });
          if (!res.ok) {
            const txt = await res.text();
            msg.textContent = '登录失败: ' + (txt || res.statusText);
            return;
          }
          // on success, redirect to index
          window.location.href = '/ui/index.html';
        } catch (e) {
          msg.textContent = '请求失败: ' + (e.message || e);
        }
      });

      document.getElementById('backBtn').addEventListener('click', () => {
        window.location.href = '/';
      });

      // optional: submit on Enter
      ['username','password'].forEach(id => {
        document.getElementById(id).addEventListener('keydown', (ev) => {
          if (ev.key === 'Enter') document.getElementById('loginBtn').click();
        });
      });
    </script>
  </body>
</html>
